<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Listado</title>
    <link href="../static/css/view.css" th:href="@{/css/view.css}" rel="stylesheet">
    <link href="../static/css/lista.css" th:href="@{/css/lista.css}" rel="stylesheet">
    <script src="../static/js/view.js" th:src="@{/js/view.js}"></script>
</head>
<body id="main_body">

<div id="form_container">
    <h1><a>List Coches</a></h1>
    <form name="formulario" action="#" method="post" id="formulario">
        <table>
            <thead>
            <tr>
                <th>Numero de Bastidor</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Kilometros</th>
                <th>Motor</th>
                <th>Modificaciones</th>
                <th>Tipo de Modificaciones</th>
                <th>Borrar Coche</th>
                <th>Modificar Coche</th>
            </tr>
            </thead>
            <tbody>
            <tr id="borrado" th:each="coche, iterator : ${coches}">
                <th><span th:text="${coche.nbastidor}"></span></th>
                <th><span th:text="${coche.marca}"></span></th>
                <th><span th:text="${coche.modelo}"></span></th>
                <th><span th:text="${coche.kilometros}"></span></th>
                <th><span th:text="${coche.motor}"></span></th>
                <th><span th:text="${coche.modificaciones}"></span></th>
                <th><span th:text="${coche.tipo_modificaciones}"></span></th>
                <th><input type="checkbox" th:value="${iterator.index}" th:name="borrado"></th>
                <th><input class="button2" type="submit" th:value="${coche.id}" th:name="update" onclick="updates()"></th>
            </tr>
            </tbody>
        </table>
        <input class="button2 button_fuera_form" type="submit" onclick="deletes()" value="Borrado">
        <input class="button2" type="submit" onclick="add()" value="AÃ±adir Coche">
    </form>
    <div id="footer">
        <h4>Generated by Carlos Castillo</h4>
    </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script th:inline="javascript">
    const form = document.getElementById('formulario');
    var coches = [[${coches}]]
    var seleccionados = 0;
    function updates() {
        form.setAttribute('action', '/listcochesupdatepost');
    }

    function deletes() {
        if(coches.length >= 2){
            for (let i = 0; i < coches.length; i++) {
                if (document.formulario.borrado[i].checked){
                    seleccionados = seleccionados + 1;
                }
            }
            if(seleccionados > 0){
                form.setAttribute('action', '/listcochesdelpost');
            }else if(seleccionados === 0) {
                form.setAttribute('action', '/');
                form.setAttribute('method', 'get');
            }
        }else{
            if (document.formulario.borrado.checked){
                seleccionados = seleccionados + 1;
            }
            if(seleccionados > 0){
                form.setAttribute('action', '/listcochesdelpost');
            }else if(seleccionados === 0) {
                form.setAttribute('action', '/');
                form.setAttribute('method', 'get');
            }
        }

    }

    function add() {
        form.setAttribute('action', '/addcoches');
        form.setAttribute('method', 'get')
    }
</script>
</html>